{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>üßæ Sales Records</h2>
  <a href="{{ url_for('core.pos') }}" class="btn btn-primary">‚ûï New Sale</a>
</div>

<!-- üîé Filters -->
<form method="get" class="row g-2 mb-3">
  <div class="col-md-3">
    <input type="text" name="search" class="form-control" placeholder="Search by ID or Customer" value="{{ request.args.get('search', '') }}">
  </div>
  <div class="col-md-3">
    <input type="date" name="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
  </div>
  <div class="col-md-3">
    <input type="date" name="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
  </div>
  <div class="col-md-3">
    <button class="btn btn-secondary w-100" type="submit">Filter</button>
  </div>
</form>

<!-- üí∞ Summary -->
{% if summary %}
<div class="alert alert-info mb-3">
  <strong>Summary:</strong> Total Sales ‚Ç±{{ "%.2f"|format(summary.total_sales) }},
  VAT ‚Ç±{{ "%.2f"|format(summary.total_vat) }},
  Transactions: {{ summary.count }}
</div>
{% endif %}

<!-- üìä Table -->
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Customer</th>
        <th>Total</th>
        <th>VAT</th>
        <th>Status</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for s in sales %}
      <tr>
        <td>#{{ s.id }}</td>
        <td>{{ s.customer_name or '‚Äî' }}</td>
        <td>‚Ç±{{ "%.2f"|format(s.total) }}</td>
        <td>‚Ç±{{ "%.2f"|format(s.vat) }}</td>
        <td>
          {% if s.status == 'paid' %}
            <span class="badge bg-success">Paid</span>
          {% elif s.status == 'refunded' %}
            <span class="badge bg-warning text-dark">Refunded</span>
          {% else %}
            <span class="badge bg-secondary">Pending</span>
          {% endif %}
        </td>
        <td>{{ s.created_at.strftime('%Y-%m-%d %H:%M') if s.created_at else '‚Äî' }}</td>
        <td>
          <a href="{{ url_for('core.view_sale', sale_id=s.id) }}" class="btn btn-sm btn-info">üîç View</a>
          <a href="{{ url_for('core.print_receipt', sale_id=s.id) }}" class="btn btn-sm btn-outline-primary">üñ® Print</a>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center text-muted">No sales recorded yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ‚¨áÔ∏è Export Buttons -->
<div class="mt-3 mb-4">
  <a href="{{ url_for('core.export_sales', format='csv') }}" class="btn btn-outline-success">‚¨á Export CSV</a>
</div>

<!-- üìÑ Pagination -->
{% if pagination.pages > 1 %}
<nav aria-label="Sales pagination">
  <ul class="pagination justify-content-center">
    {% if pagination.has_prev %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('core.sales', page=pagination.prev_num, search=search, start_date=start_date, end_date=end_date) }}">Previous</a>
    </li>
    {% endif %}

    <li class="page-item disabled">
      <a class="page-link">Page {{ pagination.page }} of {{ pagination.pages }}</a>
    </li>

    {% if pagination.has_next %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('core.sales', page=pagination.next_num, search=search, start_date=start_date, end_date=end_date) }}">Next</a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
